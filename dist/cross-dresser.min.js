/*! CrossDresser - v0.1.0 - 2015-05-14
* Copyright (c) 2015 Caleb Clark; Licensed  */
function ready(){if(!readyFired){readyFired=!0;for(var a=0;a<readyList.length;a++)readyList[a].fn.call(window,readyList[a].ctx);readyList=[]}}function readyStateChange(){"complete"===document.readyState&&ready()}var CrossDresser;!function(a){function b(a,b){var c={},d={"true":!0,"false":!1,"null":null};return $.each(a.replace(/\+/g," ").split("&"),function(a,e){var f,g=e.split("="),h=decodeURIComponent(g[0]),i=c,j=0,k=h.split("]["),l=k.length-1;if(/\[/.test(k[0])&&/\]$/.test(k[l])?(k[l]=k[l].replace(/\]$/,""),k=k.shift().split("[").concat(k),l=k.length-1):l=0,2===g.length)if(f=decodeURIComponent(g[1]),b&&(f=f&&!isNaN(f)?+f:"undefined"===f?void 0:void 0!==d[f]?d[f]:f),l)for(;l>=j;j++){h=""===k[j]?i.length:k[j];var m=k[j+1];i=i[h]=l>j?i[h]||(m&&isNaN(m)?{}:[]):f}else $.isArray(c[h])?c[h].push(f):c[h]=void 0!==c[h]?[c[h],f]:f;else h&&(c[h]=b?void 0:"")}),c}a.deparam=b}(CrossDresser||(CrossDresser={}));var CrossDresser;!function(a){var b=function(){function b(){}return b.parseUrl=function(a){for(var b=["source","scheme","authority","host","port","path","directory_path","file_name","query_string","hash"],c=new RegExp("^(?:([^:/?#.]+):)?(?://)?(([^:/?#]*)(?::(\\d*))?)?((/(?:[^?#](?![^?#/]*\\.[^?#/.]+(?:[\\?#]|$)))*/?)?([^?#/]*))?(?:\\?([^#]*))?(?:#(.*))?").exec(a),d={},e=0,f=b.length;f>e;e++)d[b[e]]=c[e]?c[e]:"";d.port=d.port?parseInt(d.port):80;var g=/^(.*?)\.?([^\.]*\.\w+)$/.exec(d.host);return g?(d.sub_domain=g[1],d.root_domain=g[2]):d.sub_domain=d.root_domain="",d.directory_path.length>0&&(d.directory_path=d.directory_path.replace(/\/?$/,"/")),d},b.parseQueryString=function(b){return a.deparam(b)},b.createId=function(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=1;20>=c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a},b.documentReady=function(a,b){return readyFired?void setTimeout(function(){a(b)},1):(readyList.push({fn:a,ctx:b}),void("complete"===document.readyState?setTimeout(ready,1):readyEventHandlersInstalled||(document.addEventListener?(document.addEventListener("DOMContentLoaded",ready,!1),window.addEventListener("load",ready,!1)):(document.attachEvent("onreadystatechange",readyStateChange),window.attachEvent("onload",ready)),readyEventHandlersInstalled=!0)))},b}();a.Utils=b}(CrossDresser||(CrossDresser={}));var readyList=[],readyFired=!1,readyEventHandlersInstalled=!1,CrossDresser;!function(a){var b={};a.frames=b;var c=function(){function c(a){if(this._id=a,!b[a])throw new RangeError("No frame exists by the referenced _id");this.instance=b[a],this.url=this.instance.url,this.height=this.instance.height,this.is_native=this.instance.is_native}return c.prototype.trigger=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];for(var d=this.callbacks(a),e=0,f=d.length;f>e;e++)d[e].apply(this,b);"native-base-ready"==a?this.loadContent():"resize-frame"==a&&this.resize.apply(this,b)},c.prototype.on=function(a,b){this.callbacks(a).push(b)},c.prototype.callbacks=function(a){return this.instance.callbacks[a]||(this.instance.callbacks[a]=[]),this.instance.callbacks[a]},c.prototype.getElement=function(){return this.element=this.element||$("iframe#"+this._id)},c.prototype.loadContent=function(){if(this.instance.content_request){var a=this;this.instance.content_request.then(function(b){a.getElement()[0].contentWindow.CrossDresser.injectIntoPage(b)})}},c.prototype.resize=function(a){return a=!a||parseInt(a)<150?150:parseInt(a),this.getElement().attr("height",a),null},c.create=function(d){f&&(d={url:f});var e=a.Utils.createId(),f=d.url.replace(/^\/\//,"http://"),g=d.attrs||{},h=d.width||500,i=d.height||450,j=!1;if(d.use_native_base){var k=(f.indexOf("?")>-1?f+"&":f+"?")+$.param(g),l=$.ajax({url:k,dataType:"jsonp",jsonp:"callback"});f=d.use_native_base,g={},j=!0}return g.crss_drssr=e+"::"+encodeURIComponent(a.current.getConduitUrl()),k&&(g.crss_drssr+="::"+encodeURIComponent(btoa(k))),f=f.indexOf("?")>-1?f+"&":f+"?",f+=$.param(g),b[e]={callbacks:{},width:h,height:i,url:f,is_native:j,content_request:l},new c(e)},c.find=function(a){return b[a]?new c(a):void 0},c.trigger=function(a,b,c){var d=this.find(a);if(!d)throw"could not find instance: "+a;c=c.slice(0),c.unshift(b),d.trigger.apply(d,c)},c}();a.ChildFrame=c}(CrossDresser||(CrossDresser={}));var CrossDresser;!function(a){var b={},c=500,d=450,e=function(){function e(a){if(this._id=a,!b[a])throw new RangeError("No frame exists by the referenced _id");this.instance=b[a],this.name=this.instance.name,this.url=this.instance.url,this.width=this.instance.width,this.height=this.instance.height}return e.prototype.trigger=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];for(var d=this.callbacks(a),e=0,f=d.length;f>e;e++)d[e].apply(this,b)},e.prototype.on=function(a,b){this.callbacks(a).push(b)},e.prototype.callbacks=function(a){return this.instance.callbacks[a]||(this.instance.callbacks[a]=[]),this.instance.callbacks[a]},e.prototype.open=function(){setTimeout(function(){var a=this.width,b=this.height,c=window.screen.height/2-b/2,d=window.screen.width/2-a/2;c-=.2*c,window.open(this.url,this.name,"toolbar=0,scrollbars=0,location=0,statusbar=0,menubar=0,resizable=1,width="+a+",height="+b+",top="+c+",left="+d)}.bind(this))},e.create=function(f){i&&(f={url:i});var g=a.Utils.createId(),h=f.attrs||{},i=f.url.replace(/^\/\//,"http://"),j=f.width||c,k=f.height||d,l=f.name||g;return h.crss_drssr=g+"::"+encodeURIComponent(a.current.getConduitUrl()),i=i.indexOf("?")>-1?i+"&":i+"?",i+=$.param(h),b[g]={url:i,name:l,width:j,height:k,callbacks:{}},new e(g)},e.find=function(a){return b[a]?new e(a):void 0},e.trigger=function(a,b,c){var d=this.find(a);if(!d)throw"could not find instance: "+a;c=c.slice(0),c.unshift(b),d.trigger.apply(d,c)},e}();a.ChildPopup=e}(CrossDresser||(CrossDresser={}));var CrossDresser;!function(a){var b;!function(b){function c(b){if(!a.current.is_frame)return console.log("Notice: Skipping resize since we're not inside an iframe");if(0==b)return g();if(!b)return h();var c=!1,d=i(b);d!=o&&(o=d,c=!0);var e=j(b);e!=p&&("auto"==e&&f(),isNaN(e)||(p=e),c=!0),c&&h()}function d(a){var b=$(a);b.data("ffcore-element-id")||b.data("ffcore-element-id",n++),m[b.data("ffcore-element-id")]=b}function e(a){delete m[$(a).data("ffcore-element-id")]}function f(b){b=b||(a.current.is_native?500:1e3),b=100>b?100:b,l&&clearInterval(l),p="auto",l=setInterval(function(){h()},b),c()}function g(){l&&clearInterval(l)}function h(){var b=$("html").css("height","auto").height();for(var c in m){var d=m[c];if("absolute"==d.css("position")){var e=d.offset().top+d.outerHeight();e>b&&(b=e)}}k&&o>b&&(b=o);var f=$(window).height();k&&(k==f||f+10>k&&k>f-10)&&(k==b||b+10>k&&k>b-10)||(k=o>b?o:b,a.trigger("resize-frame",k))}function i(a){var b;return a["min-height"]&&(b=a["min-height"]),a.minHeight&&(b=a.minHeight),a.min_height&&(b=a.min_height),b=parseInt(b),b==0/0?0:b}function j(a){var b;return a.height&&(b=a.height),b=parseInt(b),b==0/0?"auto":b}var k,l,m={},n=0,o=150,p="auto";b.run=c,b.addToHeightCalculations=d,b.removeFromHeightCalculations=e,b.enableAutosize=f,b.disableAutosize=g}(b=a.resizer||(a.resizer={}))}(CrossDresser||(CrossDresser={}));var CrossDresser;!function(a){var b;!function(b){function c(b,c){var d;return d=a.current.is_native?e(b,c):f(b,c)}function d(a,b,c,d,e){var f={frame:function(){a.ChildFrame.trigger(c,d,e)},popup:function(){a.ChildPopup.trigger(c,d,e)}};f[b]()}function e(b,c){var e=$.Deferred();return d(a.current.parent.CrossDresser,a.current.environment,a.current._id,b,c),e.resolve().promise()}function f(b,c){var d=$.Deferred(),e={_id:a.current._id,command:b,environment:a.current.environment,args:c},f=a.current.parent_conduit_url;return f=(f.indexOf("?")>-1?f+"&":f+"?")+$.param(e),a.Utils.documentReady(function(){var a=$("ff-frame-controller");a&&a.remove(),a=$('<iframe id="ff-frame-controller" src="'+f+'" width="10" height="10" style="position : absolute; top : 0px; left : 0px; visibility: hidden"></iframe>'),a.appendTo("body"),a.load(function(){d.resolve()})}),d.promise()}function g(b,c){var e=a.Utils.parseUrl(c),f=a.Utils.parseQueryString(e.query_string);if(b!=f.environment)throw Error("environment does not match params.environment");d(CrossDresser,b,f._id,f.command,f.args)}b.run=c,b.fromIframe=g}(b=a.conduit||(a.conduit={}))}(CrossDresser||(CrossDresser={}));var CrossDresser;!function(a){function b(b){a.current.config.conduit_path=b.conduit_path||a.current.config.conduit_path||d}function c(a){$(function(){$("body").html(a)})}var d="/cross-dresser.html",e={},f=function(){function b(){this.config={conduit_path:d},this.raw_url=document.location.href,this.raw_uri=a.Utils.parseUrl(this.raw_url),this.raw_params=a.Utils.parseQueryString(this.raw_uri.query_string);try{window.top&&window.top!=window.self&&document.referrer!=this.raw_url.replace(document.location.hash,"")?(this.environment="frame",this.parent=window.top,this.is_frame=!0,this.is_native=this.isNativeFrame()):window.opener||window.top&&window.top.opener?(this.environment="popup",this.parent=window.opener||window.top.opener,this.is_popup=!0):(this.environment="toplevel",this.parent=null)}catch(b){this.environment="toplevel"}this.initiateDocumentLoad(),this.is_frame&&setTimeout(function(){a.resizer.enableAutosize()})}return b.prototype.isNativeFrame=function(){try{var b=this.raw_uri.host,c=a.Utils.parseUrl(window.top.location.href).host;return c==b?!0:!1}catch(d){return!1}},b.prototype.getConduitUrl=function(){return this.raw_uri.scheme+"://"+this.raw_uri.host+([80,443].indexOf(this.raw_uri.port)>-1?"":":"+this.raw_uri.port)+(this.config.conduit_path||d)},b.prototype.initiateDocumentLoad=function(){var b=this;if(this.raw_params.crss_drssr){var c=this.raw_params.crss_drssr.split("::");if(this._id=c[0],this.parent_conduit_url=decodeURIComponent(c[1]),c[2]&&(this.url_to_load=atob(decodeURIComponent(c[2]))),this.url_to_load&&!this.is_native){var d=this.url_to_load,e=this._id+"::"+encodeURIComponent(this.parent_conduit_url);window.location.href=(d.indexOf("?")>-1?d+"&":d+"?")+"crss_drssr="+e}else if(this.url_to_load&&this.is_native){this.url=this.url_to_load,this.uri=a.Utils.parseUrl(this.url_to_load),this.params=a.Utils.parseQueryString(this.uri.query_string);var f=document.createElement("base");f.setAttribute("href","http://"+this.uri.host),document.getElementsByTagName("head")[0].appendChild(f),setTimeout(function(){b.trigger("native-base-ready",b.url_to_load)})}else"toplevel"==this.environment?console.log("NOTICE: CrossDresser parent not found - running as toplevel"):(this.url=this.raw_url,this.uri=this.raw_uri,this.params=this.raw_params)}},b.prototype.trigger=function(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];var f=a.conduit.run(b,c),g=e[b]||[];return setTimeout(function(){for(var b=0,d=g.length;d>b;b++)g[b].apply(a.current,c)}),f},b.prototype.on=function(a,b){e[a]=e[a]||[],e[a].push(b)},b}();a.config=b,a.injectIntoPage=c,a.current=new f}(CrossDresser||(CrossDresser={}));var CrossDresser;!function(a){function b(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];return a.ChildFrame.create.apply(a.ChildFrame,b)}function c(){for(var b=[],c=0;c<arguments.length;c++)b[c-0]=arguments[c];return a.ChildPopup.create.apply(a.ChildPopup,b)}function d(b){a.resizer.run(b)}a.createFrame=b,a.createPopup=c,a.resize=d,a.trigger=a.current.trigger,a.on=a.current.on}(CrossDresser||(CrossDresser={}));